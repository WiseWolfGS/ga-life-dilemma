# GA-Life

Cellular Automata for Visualization of Genetic Algorithms (Conway-aligned)

---

## 1. 프로젝트의 개요

#### 1.1. 이름 및 슬로건

-   **이름**: “GA-Life - Visualization of Genetic Algorithms”
-   **슬로건**: “Cellular Automata for Visualization of Genetic Algorithms (Conway-aligned)”

#### 1.2. 개발 목적 및 규칙 설명

-   **개발 목적**
    유전 알고리즘은 실제 생물의 진화를 모방해서 문제를 해결하는 최적화 기법의 일종이다. 유전 알고리즘은 CNN 등 인공 신경망이 인공지능의 대세가 된 지금도 인공 신경망의 초기화에 쓰이는 등 다양한 활용성을 지니고 있다. 하지만 서적 등의 예제에서 유전 알고리즘을 시각적으로 설명하는 잘 보이지 않는데, GA-Life는 세포 자동자의 각 세포에 유전 알고리즘을 적용하여 공간적으로 세포들이 진화하는 모습을 보여줌으로써 유전 알고리즘의 시각화가 가능하다고 사료된다. 또한 더 나아가 간략한 진화 시뮬레이션 모델로의 확장도 가능하다.

-   **기본 원칙**
    보드는 2D 직사각형 격자로 채워져 있으며, 경계는 토러스 경계로 한다. 칸은 크게 세포가 살아있는 칸과 죽어있는 칸으로 구분 가능하며 이 칸이 한 번 동기 업데이트 되는 걸 한 세대가 지나갔다고 표현한다. 모든 살아있는 세포는 본인 주변 8개의 칸에 영향력을 끼치는데, 이 영향력에 따라 다음 세대에서 칸이 세포가 살아있는 칸이 될지 죽어있는 칸이 될지의 여부가 결정된다. 영향력은 소수점 둘째 자리에서 반올림한다.

    칸에 미치는 영향력이 너무 많은 경우도, 너무 적은 경우도 생존/탄생에 불리하게 설계를 하는 것이 GA-Life의 목적 중 하나이며, 그렇기에 기본적으로 형태 유전자간 우위는 존재하지 않는다. 다만 칸의 지형 및 환경은 위치 별로 다르게 생존에 유리한 형태 유전자가 생기도록 만들 수 있는 요소이다.

-   **형태 유전자와 영향력**
    모든 세포는 형태 유전자를 가지고 있으며, 살아있는 세포가 주변 8칸에 미치는 영향력의 크기는 그 세포가 탄생할 때 정해지는 형태 유전자에 따라 달라진다. 각각의 세포는 형태 유전자 `[U,D,L,R] ∈ {2,4,6,8,10}`을 가지고 있으며, 각각의 값은 상/하/좌/우에 해당 값만큼의 영향력을 준다는 것을 의미한다. 여기서 대각선은 `(관련된 두 값 평균 - 1)`로 계산 가능한데, 예를들어 `[10, 4, 6, 8]`의 형태 유전자를 가진 세포는 왼쪽 위의 칸에 7만큼의 영향력을 행사한다. 예시를 전부 나타내면 다음과 같다.

    <예시 - 영향력>
    ```
    [[7, 10, 8],
     [6,  X, 8],
     [4,  4, 5]]
    ```
    이런 규칙을 따르는 만큼 주변 살아있는 세포가 주는 영향력의 총합인 `S_total`은 지형 등 다른 보정 없이는 최대 76이다.

#### 1.3. 기존 연구와의 차별점

GA-Life는 기존 인공 생명 프로젝트들과 다음과 같은 차별점을 통해 '공간적 유전 알고리즘 동역학' 관찰이라는 고유한 목표에 집중합니다.

1.  **내재적 적합도(Intrinsic Fitness)**: Avida와 달리, 외부 과제 해결이 아닌 시스템의 물리 법칙(생존/탄생 확률) 안에서 '생존과 번식' 자체가 유일한 목표가 됩니다. 이는 순수한 진화 압력이 만들어내는 패턴을 관찰하는 데 최적화되어 있습니다.

2.  **내장된 국소적 진화(Built-in & Local Evolution)**: Lenia의 외부 루프 진화와 달리, GA-Life는 세포가 탄생하는 모든 위치에서 '선택-교차-변이'가 일어나는, 진화 자체가 핵심 규칙으로 내장된 모델입니다.

3.  **확률론적 규칙(Probabilistic Rules)**: 콘웨이의 생명 게임의 결정론적 규칙을 넘어, 연속적인 확률 모델을 사용함으로써 더 다채롭고 예측 불가능한 유기적 패턴의 발현을 목표로 합니다.

---

## 2. 생존/죽음 및 탄생/미탄생 판정

#### 2.1. 기본 규칙

-   **생존/사망 및 탄생/미탄생의 정의**
    -   **생존**: 현 세대의 살아있는 칸이 다음 세대에도 살아있는 칸으로 유지되는 경우.
    -   **사망**: 현 세대의 살아있는 칸이 다음 세대에는 죽어있는 칸으로 변하는 경우.
    -   **탄생**: 현 세대의 죽어있는 칸이 다음 세대에는 살아있는 칸으로 변하는 경우.
    -   **미탄생**: 현 세대의 죽어있는 칸이 다음 세대에도 죽어있는 칸으로 유지되는 경우.

    초기화 시, 별도 설정을 하지 않는 이상 세포 밀도 `ρ = 0.25`로 생성된다.

-   **연속 확률 모델**
    로지스틱 함수 `σ(x)=1/(1+e^(-x))`를 기반으로, 해당 칸이 받는 총 영향력(`S_total`)에 따라 생존/탄생 확률이 연속적으로 결정된다.

    <수식 - p_live: 생존 확률, p_born: 탄생 확률>
    ```math
    \begin{aligned}
    &p_{live}(S_{total}) = \text{clip}(\alpha \cdot \{\sigma(\beta \cdot (S_{total} - \mu))\} \cdot \{1 - \sigma(\beta \cdot (S_{total} - \mu))\}^\gamma + \delta, 0, 1) \\
    &p_{dead}(S_{total}) = 1 - p_{live}(S_{total}) \\
    &p_{born}(S_{total}) = \text{clip}(\alpha \cdot \{\sigma(\beta \cdot (S_{total} - \nu))\} \cdot \{1 - \sigma(\beta \cdot (S_{total} - \nu))\}^\gamma + \delta, 0, 1) \\
    &p_{unborn}(S_{total}) = 1 - p_{born}(S_{total})
    \end{aligned}
    ```



-   **연속 확률 모델의 예외 사항**
    -   계산된 확률값이 `ε`보다 작을 경우 0으로 처리한다.
    -   탄생은 주변 8칸에 살아있는 세포(또는 '항상 생존' 환경)가 1개 이상 존재해야만 가능하다.

#### 2.2. 지형 및 환경

-   **기본 설명**: 지형과 환경은 모두 칸에 종속된다. 지형은 불변의 속성이지만, 환경은 조건에 따라 변할 수 있다. 이 구분은 '지형'의 효과를 시뮬레이션 시작 시 미리 계산해두는 최적화를 가능하게 한다.

-   **지형 (Terrain)**
    1.  **높낮이 지형**: 주변 칸과의 높이 차에 따라 영향력이 보정된다.
    2.  **영향력 2배 지형**: 해당 칸의 세포가 전파하는 영향력을 2배로 증폭시킨다.
    3.  **영향력 1/2배 지형**: 해당 칸의 세포가 전파하는 영향력을 1/2배로 감소시킨다.

-   **환경 (Environment)**
    1.  **항상 생존 환경**: 해당 칸은 항상 살아있는 상태로 판정된다.
    2.  **항상 사망 환경**: 해당 칸은 항상 죽어있는 상태로 판정된다.
    3.  **강제 변이 환경**: 해당 칸에서 세포 탄생 시 100% 확률로 변이가 발생한다.
    4.  **추가 자원 환경**: 확률 수식의 `δ` 값을 0.1만큼 올려 생존/탄생에 유리하게 만든다.
    5.  **노이즈 환경**: `δ` 값을 -0.05 ~ 0.05 사이에서 무작위로 변화시킨다.

#### 2.3. 주요 파라미터 (Key Parameters)

GA-Life 모델의 핵심 동작을 제어하는 주요 파라미터는 다음과 같습니다. 이 값들은 UI를 통해 실시간으로 조작할 수 있습니다.

| 파라미터 (Parameter) | 기본값 (Default) | 설명 (Description)                                                               |
| :------------------- | :--------------- | :------------------------------------------------------------------------------- |
| `α` (alpha)          | `4`              | 확률 곡선의 전체적인 높이를 조절합니다.                                          |
| `β` (beta)           | `-0.3`           | 확률 곡선의 민감도(기울기)를 조절합니다. 음수 값은 볼록한 형태를 만듭니다.        |
| `γ` (gamma)          | `1`              | 확률 곡선 우측의 감쇠 정도를 조절합니다.                                         |
| `μ` (mu)             | `27.0`           | **생존** 확률이 최대가 되는 최적 영향력(`S_total`) 값입니다.                     |
| `ν` (nu)             | `34.5`           | **탄생** 확률이 최대가 되는 최적 영향력(`S_total`) 값입니다.                     |
| `δ` (delta)          | `0.18`          | 전체 확률에 더해지는 기본 상수로, 생존/탄생의 기본 기회를 조절합니다.            |
| `ε` (epsilon)        | `0.003`          | 이 값보다 작은 확률은 0으로 처리하여 불필요한 연산을 줄입니다.                   |
| `p_mut`              | `0.02`           | 자손의 형태 유전자에 변이가 일어날 확률입니다.                                        |
| `θ` (theta)          | `0.01`           | 죄수의 딜레마 상호작용의 보상/비용 크기를 결정합니다.                            |

---

## 3. 유전 알고리즘

#### 3.1. 초기화 (상호 배타적)
-   **정규분포 기반 확률 초기화 (기본값)**: 평균 6, σ≈2 정규분포에 따라 형태 유전자를 생성한다.
-   **동일 확률 초기화**: 모든 형태 유전자가 동일한 확률로 나타난다.
-   **극단 확률 강화 초기화**: 양 극단값(2, 10)의 등장 확률을 높인다.
-   **모두 [6, 6, 6, 6] 초기화**: 모든 세포의 형태 유전자를 `[6, 6, 6, 6]`으로 통일한다.

#### 3.2. 부모 선택
-   **후보 선정**: 새로운 세포가 탄생할 칸의 주변 8칸에 있는 살아있는 세포들이 부모 후보다.
-   **적합도 계산**: 각 후보의 생존 확률(`p_live`)을 적합도로 사용하여, 적합도가 높을수록 부모로 선택될 확률이 높아진다.

#### 3.3. 교차 (상호 배타적)
-   **부모 동일 확률 50/50 (기본값)**: 형태 유전자의 각 좌위(U, D, L, R)를 50% 확률로 양 부모에게서 물려받는다.
-   **24칸 다수결**: 주변 24칸의 유전자 분포를 고려하여, 더 흔한 형태 유전자를 물려받을 확률을 높인다.

#### 3.4. 변이 (상호 배타적)
-   **부분 변이 (기본값)**: 각 형태 유전자 좌위에 대해 개별적으로 변이 확률(`p_mut`)을 적용한다.
-   **전체 변이**: 변이가 발생하면 4개의 형태 유전자 전체를 균등 확률로 다시 선택한다.

#### 3.5. 한 틱 파이프라인 (Detailed)
한 세대(tick)가 진행되는 과정은 다음과 같은 명확한 단계로 구성되며, 이는 다음 세대의 상태가 현재 세대에만 의존하도록 보장합니다 (동기 업데이트).

1.  **이웃 영향 합산 (Influence Aggregation)**
    -   전체 격자 크기와 동일한 `influence_grid`를 0으로 초기화합니다.
    -   현재 세대의 격자를 순회하며 살아있는 모든 세포를 찾습니다.
    -   각 살아있는 세포에 대해, 자신의 형태 유전자와 지형 효과를 바탕으로 주변 8칸에 전파할 영향력을 계산하고, 이 값을 `influence_grid`의 해당 칸에 더해줍니다.

2.  **판정 및 자손 생성 (Judgment & Reproduction)**
    -   다음 세대의 상태를 저장할 `next_generation_grid`를 준비합니다.
    -   현재 격자의 모든 칸(0,0부터)을 순회합니다.
        -   해당 칸의 `influence_grid` 값(`S_total`)과 환경 효과를 종합합니다.
        -   현재 칸이 살아있으면 `p_live` 공식으로 생존 여부를, 죽어있으면 `p_born` 공식으로 탄생 여부를 확률적으로 판정합니다.
        -   판정 결과를 `next_generation_grid`에 기록합니다.
        -   **(탄생 시)**: 세포 탄생이 결정되면, `3.2 ~ 3.4`의 유전 알고리즘(부모 선택, 교차, 변이)을 수행하여 자손의 형태 유전자를 결정하고 `next_generation_grid`에 함께 저장합니다.

3.  **동기 커밋 (Synchronous Commit)**
    -   모든 칸에 대한 판정이 끝나면, 현재 세대 격자를 `next_generation_grid`로 완전히 교체합니다.
    -   이로써 한 세대의 업데이트가 완료됩니다.

---

## 4. 기술 스택 및 아키텍처

본 프로젝트는 웹 환경에서 높은 성능의 시뮬레이션과 상호작용이 가능한 UI를 구현하기 위해 다음과 같은 기술 스택과 아키텍처를 채택합니다.

#### 4.1. 기술 스택 (Technology Stack)

-   **Core Engine**: **Rust / WebAssembly (WASM)**
    -   세포 자동자, 유전 알고리즘 등 모든 무거운 연산을 담당합니다. Rust의 높은 성능과 메모리 안전성을 통해 C/C++에 버금가는 속도를 웹에서 구현합니다.
-   **Frontend Framework**: **React (with TypeScript)**
    -   UI 컴포넌트, 상태 관리, 사용자 상호작용을 담당합니다. TypeScript를 통해 코드의 안정성과 유지보수성을 높입니다.
-   **Rendering**: **HTML5 Canvas**
    -   수천 개의 세포를 효율적으로 화면에 그리기 위한 렌더링 계층입니다.

#### 4.2. 아키텍처 (Architecture)

성능과 관심사의 분리를 위해 3-Layer 아키텍처를 사용합니다.

1.  **Core Layer (Rust/WASM)**: 순수한 시뮬레이션 로직만 포함하는 엔진입니다. 외부 세계(웹)에 대한 의존성이 없습니다.
2.  **Bridge Layer (TypeScript)**: React 애플리케이션과 WASM 엔진 사이를 잇는 다리입니다. WASM 모듈을 로드하고, 데이터와 이벤트를 양방향으로 변환 및 전달합니다.
3.  **View Layer (React/Canvas)**: 사용자에게 보여지는 모든 UI와 시뮬레이션 화면을 담당합니다.

#### 4.3. 렌더링 파이프라인 (Rendering Pipeline)

매끄러운 애니메이션을 위해 `requestAnimationFrame`을 사용한 렌더링 루프를 구성하며, 성능 최적화를 위해 다음의 파이프라인을 따릅니다.

1.  **JS**: `requestAnimationFrame` 루프 내에서 WASM 엔진의 `tick()` 함수를 호출하여 시뮬레이션을 한 세대 진행시킵니다.
2.  **JS -> Rust**: `tick()` 함수가 Rust 내부에서 실행됩니다.
3.  **Rust -> JS**: 시뮬레이션이 끝난 후, JS는 Rust로부터 세포 데이터 전체를 **복사하는 대신**, 데이터가 저장된 **WASM 메모리의 포인터(pointer)를 전달받습니다.**
4.  **JS**: 전달받은 포인터를 이용해 WASM의 메모리를 직접 읽는 `TypedArray`를 생성합니다.
5.  **Canvas**: 이 `TypedArray`를 순회하며 각 세포의 상태를 읽어와 `Canvas`에 빠르게 렌더링합니다.
이 방식은 JS와 WASM 간의 데이터 전송 비용을 '0'에 가깝게 만들어줍니다.

---

## 5. UI/UX

#### 5.1. 기본 화면 구성
-   메인 실행 화면
-   파라미터/지형 에디터

#### 5.2. 볼 수 있는 레이아웃
-   형태 유전자 맵 (각 형태 유전자를 색상으로 표현)
-   지형 & 환경 맵
-   확률 맵 (각 칸의 생존/탄생 확률을 시각화)

#### 5.3. 통계
-   세포가 살아있는 칸의 밀도
-   세대별 탄생/사망 이벤트 수
-   세포의 평균 수명

---

## 6. 기타 기능

-   **시드 고정**: 동일한 시뮬레이션을 재현할 수 있도록 랜덤 시드를 고정하는 기능.
-   **파라미터 개별 설정**: UI를 통해 모든 파라미터를 실시간으로 조작.
-   **설정 저장/불러오기**: 재현성을 위해 시드와 모든 파라미터 설정을 JSON 파일로 저장하고 불러오는 기능.
-   **죄수의 딜레마**: `δ`을 이용한 상호작용과 세포 별 메모리 할당을 통한 전략 기능을 넣어 CA 시뮬레이션으로써의 가치를 올린다.

#### 6.1. 사회적 상호작용과 전략의 진화: 죄수의 딜레마

이 메커니즘은 GA-Life를 단순한 유전자 적응 시뮬레이션을 넘어, **사회적 행동과 전략이 진화하는 과정을 탐구하는 생태계 시뮬레이션**으로 확장합니다. 물리적 환경(지형)뿐만 아니라, 다른 개체와의 상호작용(사회적 환경)이 생존에 어떤 영향을 미치는지 관찰하는 것을 목표로 합니다.

1.  **전략 유전자 (Strategy Gene)**
    *   모든 세포는 탄생 시, 물리적 특성을 결정하는 `[U,D,L,R]` 유전자와는 별개로, 행동 방식을 결정하는 **'전략 유전자'**를 부여받습니다.
    *   전략의 예: '항상 협력(Cooperative)', '항상 배반(Defective)', '눈에는 눈, 이에는 이(Tit-for-Tat)', '변덕쟁이(Random)' 등.

2.  **상호작용 및 기억 (Interaction & Memory)**
    *   매 세대마다, 살아있는 세포는 주변 8칸의 다른 살아있는 세포들과 '죄수의 딜레마' 게임을 동시에 진행합니다.
    *   각 세포는 자신의 '전략 유전자'에 따라 협력(Cooperate) 또는 배반(Defect)을 선택합니다.
    *   'Tit-for-Tat'과 같은 조건부 전략을 위해, 각 세포는 주변 8칸 개체들의 직전 행동을 기억할 수 있는 메모리를 가집니다.

3.  **보상과 비용 (Payoff & Cost)**
    *   상호작용의 결과는 생존/탄생 확률 수식의 `δ` 값을 직접적으로 변경하여 생존 가능성에 즉시 영향을 줍니다. 보상 매트릭스는 다음과 같습니다.
        *   **나(협력) - 상대(협력)**: 상호 이익. 나의 `δ`가 `+θ` 만큼 증가합니다.
        *   **나(협력) - 상대(배반)**: 이용당함. 나의 `δ`가 `-θ` 만큼 감소합니다.
        *   **나(배반) - 상대(협력)**: 착취 성공. 나의 `δ`가 `+3θ` 만큼 증가합니다.
        *   **나(배반) - 상대(배반)**: 상호 불신. `δ` 값에 변화가 없습니다.

4.  **탐구 목표 (Research Goal)**
    *   이 시스템을 통해 **"최적의 생존 전략은 고정되어 있지 않으며, 주변 집단의 전략 분포에 따라 동적으로 결정된다"** 는 가설을 검증합니다.
    *   예를 들어, 배반자가 많은 환경에서는 소수의 협력자가 착취당해 도태되지만, 협력자가 안정적인 군집을 이룬 환경에서는 배반자가 단기적 이득을 취하더라도 장기적으로 고립되어 소멸하는 과정을 관찰할 수 있을 것입니다. 이는 협력의 진화에 대한 중요한 통찰을 제공할 수 있습니다.

---

## 7. 마무리

#### 7.1. 프로젝트의 핵심 가설 및 최종 목표

GA-Life 프로젝트는 단일한 정답이 없는 복잡계에서 적응과 진화가 어떻게 일어나는지를 탐구하며, 아래의 두 가지 핵심 가설을 시각적, 통계적으로 증명하는 것을 최종 목표로 삼습니다.

**가설 1: 물리적 적응 (Physical Adaptation)**
> "최적의 **형태 유전자**(`[U,D,L,R]`)는 고정되어 있지 않으며, 주어진 **물리적 환경(지형)**에 따라 결정된다."

이는 특정 지형(예: 산악, 평야)에서 각기 다른 형태 유전자 그룹이 번성하는 모습을 보여줌으로써 증명됩니다. 예를 들어, '산악 지형'에서는 상(U) 유전자가, '평야 지형'에서는 좌/우(L/R) 유전자가 우세해지는 현상을 관찰하고자 합니다.

**가설 2: 사회적 적응 (Social Adaptation)**
> "최적의 **전략 유전자**(협력/배반 등)는 고정되어 있지 않으며, 주변 개체들의 전략 분포로 구성된 **사회적 환경**에 따라 결정된다."

이는 죄수의 딜레마 메커니즘을 통해, 배신 전략이 단기적으로 유리해 보여도 협력적 군집 내에서는 장기적으로 고립되어 도태되고, 오히려 협력 전략이 생존에 더 유리해지는 동적인 과정을 보여줌으로써 증명됩니다. 이를 통해 GA-Life는 단순한 유전자 시각화를 넘어 새로운 방식의 **생태계 시뮬레이션**으로 확장됩니다.

**검증 방법론**
위 가설들은 단순히 직관적인 관찰을 넘어, 통계적 데이터로 검증하는 것을 목표로 합니다. 이를 위해 유전자/전략 점유율, 샤논 엔트로피, 군집(클러스터) 분포, 세대별 이벤트 수 등의 통계 기능을 구현하며, 필요시 Python API를 통해 더 깊이 있는 분석을 수행할 예정입니다.

#### 7.3. 추가하면 좋을 점

-   사용자 편의를 위해, 민감도 파라미터 `β`를 직접 입력하는 대신 "원하는 반치폭(FWHM)"을 입력하면 내부적으로 `β`를 역산하여 적용하는 기능.
-   좀 더 생태계 시뮬레이션으로써 활용 가능하도록 포식자와 피식자 기능.

##### 기반 현상 (Foundational Phenomena)

위 최상위 목표를 달성하고 관찰하기 위해, 시스템이 먼저 다음과 같은 기본적인 현상들을 안정적으로 보여줄 수 있어야 합니다.

1.  **안정성 (Stability)**: 시스템이 생명을 유지할 수 있는 기본적인 능력을 갖추었는가?
2.  **이동성 (Mobility)**: 국소적 규칙이 거시적인 움직임을 만들어내는가?
3.  **주기성 (Periodicity)**: 시스템 내에 동적인 평형 상태가 나타나는가?

---
