# 2025년 12월 23일 개발 로그

## 🎯 오늘의 목표
- 핵심 게임플레이 루프 완성을 위한 유전 알고리즘 및 지형 시스템 구현
- 시뮬레이션 관측 및 재현을 위한 편의 기능 추가
- 코드베이스 점검 및 버그 수정

## ✅ 완료된 작업

### 1. 핵심 유전 알고리즘 구현 (Default Rules)
- `README.md`의 기본 규칙(룰렛 휠 선택, 균등 교차, 부분 변이)에 따라 자손의 유전자를 결정하는 전체 파이프라인을 구현했습니다.
- 유전 알고리즘 로직을 별도의 `packages/core/src/sim/ga.ts` 모듈로 분리하여 관리 용이성을 높였습니다.
- `step` 함수 내에서 세포 탄생 시, `runGeneticAlgorithm`이 호출되도록 통합했습니다.

### 2. 지형 시스템 구현 (영향력 배율)
- 세포가 위치한 칸에 따라 영향력 전파에 배율이 적용되는 지형 시스템의 기반을 구현했습니다.
- **데이터 구조 확장**: `Grid` 타입에 `terrain` 배열을 추가하고, `TerrainType` ('normal', 'double', 'half')을 정의했습니다.
- **로직 구현**:
    - `init.ts`: 그리드 생성 시 각 칸에 지형을 무작위로 할당합니다.
    - `influence.ts`: 영향력 계산 시 지형 배율(2x, 0.5x)을 적용하도록 수정했습니다.

### 3. 관측성 및 편의 기능 개선
- **뷰 모드 확장**:
    - 유전자의 각 방향(Up, Down, Left, Right)별 영향력을 개별적으로 확인할 수 있는 뷰 모드를 추가했습니다.
    - 지형의 분포를 한눈에 볼 수 있는 'Terrain Map' 뷰 모드를 추가했습니다.
- **색상 로직 개선**: 유전자 값에 따른 색상 표현을 이산적인 색상에서 연속적인 스펙트럼(파랑-초록-빨강)으로 변경하여 값의 변화를 더 직관적으로 관찰할 수 있도록 개선했습니다.
- **설정 저장/불러오기**:
    - 현재 시뮬레이션의 모든 상태(그리드, 파라미터)를 JSON 파일로 저장하는 기능을 구현했습니다.
    - 저장된 JSON 파일을 불러와 특정 상태를 그대로 복원하는 기능을 구현했습니다.

### 4. 코드 점검 및 버그 수정
- **`epsilon` 파라미터 미적용 버그 수정**: 확률 계산 시 `epsilon` 값보다 작은 확률을 0으로 처리하는 로직이 누락된 것을 발견하고, `step.ts`에 해당 로직을 추가하여 수정했습니다.
- **렌더링 버그 수정**: 유전자 뷰에서 잘못된 유전자 값으로 인해 세포가 죽은 것처럼 보이던 버그를 연속적인 색상 스펙트럼을 도입하여 해결했습니다.

## 📝 요약 및 다음 단계
- 핵심 기능인 유전 알고리즘과 지형 시스템의 기본 구현을 완료했으며, 다양한 뷰 모드와 저장/불러오기 기능을 통해 시뮬레이션의 분석 및 재현성을 크게 향상시켰습니다.
- 코드 점검을 통해 초기 MVP 구현 단계에서 누락되었던 로직을 보강하고 버그를 수정하여 안정성을 높였습니다.

## 🚀 다음 세션 목표: 통계/로그 기능 구현

다음 세션에서는 GA-Life를 한 단계 더 발전시키기 위해, `README.md`에 정의된 통계/로그 기능 구현을 목표로 합니다.

1.  **밀도(ρ)**: 매 `tick`마다 `alive_count / total_cells`로 계산되어 UI에 표시/시간에 따라 업데이트합니다.
2.  **세대별 탄생/사망 이벤트 수**: `tick` 한 번에서 births, deaths 카운트가 계산되고, UI/로그에 기록합니다.
3.  **평균 수명**: 현재 `alive` 셀의 `age` 평균을 UI에 나타냅니다.

---

## 추가 기록: RNG 재현성 강화 (보완)
- 시드 기반 PRNG(`createRng`)를 도입해 결정적 난수 생성이 가능하도록 함.
- RNG 내부 상태를 `getState`/`setState`로 저장·복원 가능하게 확장.
- 저장/불러오기 JSON에 `seed`와 `rngState`를 포함하여 **중간 상태 재현**을 지원.
- `createGrid`, `step`, `runGeneticAlgorithm`에 RNG 주입 경로 정리.
- Vitest로 **동일 시드/다른 시드/상태 복원** 재현성 테스트 추가.
- 깨져 보이던 한국어 주석을 영어로 정리해 인코딩 이슈 해소.

### 후속 후보
- 확률 맵 뷰(`p_live` 또는 `p_born`) 추가.
- 환경(Environment) 최소 구현(항상 생존/사망/강제 변이/추가 자원/노이즈).
